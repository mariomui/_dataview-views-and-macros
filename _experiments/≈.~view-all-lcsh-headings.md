---
TEMPLATE_VERSION: v1.0.7
TEMPLATE_SOURCE: "[[10--nascent-spec-template]]"
tags:
  - _misc/_wip
MUID: MUID-133
nextPageIndex: 490
DOC_VERSION: v.0.0.4
---

# -

## 10-About

[[~view-for-unused-MUIDs,nb.-MUID-1196]]
## 11-Reference

# =

**base_filepath-v0.0.5**: `= choice( contains(this.file.folder, this.file.name), link(this.file.path), join(["*",this.file.path,"*"], ""))` doc-`= this.DOC_VERSION` / ids: `= this.MUID`,PP:`= this.PROJECT_PARENT` / lcsh: `= this.heading`

- ! For headings to register, we need to modify the heading

```dataviewjs


const { default: obs } = this.app.plugins.plugins["templater-obsidian"].templater.current_functions_object.obsidian;

const {workspace,fileManager, vault, metadataCache} = this.app;

const paginationFieldName = "nextPageIndex"

const getCurrentfilepath = () => this.currentFilePath;


// Early setup
let lcshHeadings = metadataCache.getFrontmatterPropertyValuesForKey("heading")

const pkg = binarySearch(lcshHeadings);

// lcshHeadings.splice(
  // pkg.max + 1
// )
lcshHeadings = lcshHeadings.slice(
  pkg.max + 1
)


function binarySearch(arr) {
  let left = 0;
  let right = arr.length - 1;
  let max = -Infinity;
  let repCnt = 0;
  while (left <= right) {
    const mid = Math.floor((left + right) / 2);
    // console.log({m:arr[mid],mid})

    repCnt +=1;
    if (arr[mid].startsWith("[[")) {
      max = Math.max(mid,max)
      left = mid + 1; // Search in the right half
    } else {
      right = mid - 1; // Search in the left half
    }
  }
  return {repCnt,max}; // Target not found
}
// console.log({pkg})

workspace.onLayoutReady(() => {

  let initialIndex = 0;
  let paginationCnt = 15;
  const metadataEditor = workspace.getActiveFileView().metadataEditor
  const serializeYaml = metadataEditor.serialize;
  const synchronizeYaml = metadataEditor.synchronize;

  const fm = metadataEditor.serialize();
  const mainCfg = {
    initialIndex: fm?.[paginationFieldName] || 0,
    lcshHeadings,
    paginationCnt,
    paginationFieldName,
    renderButton: renderButton.bind(this),
    serializeYaml: serializeYaml.bind(metadataEditor),
    synchronizeYaml: synchronizeYaml.bind(metadataEditor)
  }
  main.call(this, mainCfg)
});


function main(cfg) {


  genMain.call(this, cfg)

}

async function genMain(cfg) {

  // ## provider
  
  const providing_path = getCurrentfilepath();
  const pvf = vault.getAbstractFileByPath(providing_path);

  // ## consumer
  const cvf = workspace.getActiveFile();

  // ## Throw on Setup Error
  if (!renderButton) throw new Error("rendering function missing");

  try {
    myRender.call(this, cfg);
  } catch(e) {
    throw new Error(JSON.stringify({e, etext: "error problems"}))
  }
}

  // Render
function myRender(cfg) {
  const lcshHeadingsLength = cfg.lcshHeadings?.length ?? 0;
  const CMD = {
    NEXT: "next",
    PREV: "prev"
  }

  cfg.renderButton(
    CMD.PREV, 
    onRender.bind(this)
  )
  cfg.renderButton(
    CMD.NEXT, 
    onRender.bind(this)
  )
  

  onRender.call(this, CMD.SAME)


  function onRender(cmd) {
    const fm = cfg.serializeYaml();
    let _initialIndex;

    _initialIndex = cfg.initialIndex;
    if (
      fm.hasOwnProperty(cfg.paginationFieldName)
    ) {
      _initialIndex = fm[cfg.paginationFieldName]
    }
    let lastIndex = 0;
    const slices = [];

    if (cmd === CMD.NEXT) {
      lastIndex = (_initialIndex + cfg.paginationCnt) > lcshHeadingsLength ? lcshHeadingsLength : (_initialIndex + cfg.paginationCnt);
      slices.splice(
        0,0,
        ...cfg.lcshHeadings.slice(_initialIndex, lastIndex)
      )
    }
    if (cmd === CMD.PREV) {

      const rewindedIndex = _initialIndex - (2 * cfg.paginationCnt); // 40 - 15 = 35 35
      _initialIndex = rewindedIndex <= 0 ? 0 : rewindedIndex;
      lastIndex = _initialIndex + cfg.paginationCnt;
      slices.splice(
        0,0,
        ...cfg.lcshHeadings.slice(_initialIndex, lastIndex)
      );
      // console.log({slices, rewindedIndex, lastIndex, _initialIndex})
    }
    if (cmd === CMD.SAME) {
      const rewindedIndex = _initialIndex - cfg.paginationCnt
      _initialIndex = rewindedIndex <= 0 ? 0 : rewindedIndex;
      lastIndex = _initialIndex + cfg.paginationCnt;
      slices.splice(
        0,0,
        ...cfg.lcshHeadings.slice(
          rewindedIndex, lastIndex
        )
      );
    }


    const formatted_slices = slices.reduce((chain, slice) => {
      const text = wikilinkToText(slice);
      const link = metadataCache.getFirstLinkpathDest(text,"")
      if (link) {
        chain += `* [[${slice}]]\n`;
      }
      if (link === null) {
        chain += `* <b style="filter: hue-rotate(180deg) saturate(0%) brightness(100%)"> [[${slice}]]</b>\n`
      }
      return chain;
    }, "")
    const nextPageIndex = (lastIndex >= lcshHeadingsLength) ? 0 : lastIndex;
    const updatedFm = Object.assign(fm, {[paginationFieldName]: nextPageIndex})

    const child = Array.from(this.container.children)
      .find((l) => {
        return l.nodeName === "UL"
      })
    if (child) this.container.removeChild(child)

    cfg.synchronizeYaml(updatedFm)
    // // render
    // what's the difference between serialize and properties? prolly one is a function, the other isnt'
    manuEmbed(this, formatted_slices, this.container);
  }
}  

function wikilinkToText(wikilink) {
  const match = wikilink.match(/\[\[(.*?)\]\]/);
  return match ? match[1] : wikilink;
} // used with file link 
    

// # Rendering

function renderButton(cmd,clickHandler) {
  new obs.ButtonComponent(
    this.container
  )
  .setButtonText(cmd)
  .onClick(() => {
    clickHandler(cmd)
  })
}


function manuEmbed(
  ctx,
  markdown,
  container,
  sourcePath,
  isEmbed = false
) {
  // static render(app: App, markdown: string, el: HTMLElement, sourcePath: string, component: Component): Promise<void>;

  const render = isEmbed === true ? obs.MarkdownPreviewView.render : obs.MarkdownRenderer.render
  return render
    .call(
      ctx,
      ctx.app,
      markdown,
      container,
      sourcePath,
      ctx.component
    );
}
```

---

---

# ---Transient Doc Log

- v0.0.3 *2025-03-07*
	- Fix bug where i only collected headings that had brackets and not the full gamut. 97? bah.
* v.0.0.2 *2025-01-07*
  * Replace old processsFrontMatter logic with metadataEditor synchronize which updates the codeeditor specifically rather than the enitre note. This stabilizes the synchronization.
    * Problem with the process is that there is an infinite loop on staying still as the refresh causes the code to register the first render.
    * ? Added a klooge clause to not refresh if the elements have 3 (stop gap)
      * ðŸ”‘ Remove klooge and add a third render for situations where the data refreshes every 10 seconds as per dataview cycling. It will load the correct slices.
  * Add color hue change because I can't overrride native class of anchor links.

# ---Transient

```js


async function genMain(carryover = null) {

  await fileManager.processFrontMatter(vf, async (fm) => {

    if (!fm.hasOwnProperty(paginationFieldName)) {
      fm[paginationFieldName] = 0;
      workspace.onLayoutReady(() => {

        manuEmbed(this, formatted_slices , this.container);
        renderButtons.call(this, fm);
      })
      return;
      // return genMain.call(this, 0);
    }
    

    if (carryover !== null) {

      fm[paginationFieldName] = carryover



    }
    renderButtons.call(this, fm);

    function renderButtons(fm) {
      if (Number.isNumber(fm[paginationFieldName])) {
        renderButton.call(this,"Prev", async () => {  
          
          const difference = fm[paginationFieldName] - paginationCnt;
          fm[paginationFieldName] = difference < 0 ? 0 : difference;  

          genMain.call(this, fm[paginationFieldName]);
          // return new obs.Notice(fm[paginationFieldName], 7000);
        });
        renderButton.call(this,"Next", async () => {  
          fm[paginationFieldName] = fm[paginationFieldName] + paginationCnt;

          genMain.call(this, fm[paginationFieldName]);
          // return new obs.Notice(fm[paginationFieldName], 7000);
        });
        renderButton.call(this, "Reset", async () => {
          fm[paginationFieldName] = 0;
          genMain.call(this, 0)
        })
      } 
    }
  })
}

//dv.list(lcshHeadings)

```

- @ :seo: css snippet
	- `* <b style="filter: hue-rotate(180deg) saturate(0%) brightness(100%)"> ${slice}</b>\n`
	- change the hue in an easier fashion.